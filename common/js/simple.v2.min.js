(function(k, y) {
  function t(a) {
    return "#" + ("00000" + a.toString(16)).slice(-6);
  }
  function q(a) {
    function b() {
    }
    b.prototype = a;
    return new b;
  }
  function m() {
  }
  function p(a) {
    this.w = a || function(a, c) {
      return a - c;
    };
  }
  function C(a, b) {
    var c = new XMLHttpRequest;
    c.responseType = "text";
    c.addEventListener("load", function() {
      var a;
      a = c.responseText.replace(/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/g, "");
      a = (new k.DOMParser).parseFromString(a, "text/xml");
      b(null, a);
    });
    c.addEventListener("error", function() {
      b("error");
    });
    c.addEventListener("abort", function() {
      b("error");
    });
    c.open("GET", a, !0);
    c.send();
  }
  function D(a, b, c, d) {
    d = d || "POST";
    var e = [], f;
    for (f in b) {
      e.push(encodeURIComponent(f) + "=" + encodeURIComponent(b[f]));
    }
    b = e.join("&");
    var l = new XMLHttpRequest;
    l.withCredentials = !0;
    l.responseType = "text";
    l.addEventListener("load", function() {
      c(null, l.responseText);
    });
    l.addEventListener("error", function() {
      c("error");
    });
    l.addEventListener("abort", function() {
      c("error");
    });
    "GET" == d && (a += (-1 == a.indexOf("?") ? "?" : "&") + b);
    l.open(d, a, !0);
    "POST" == d ? (l.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), l.send(b)) : l.send();
  }
  function z() {
    this.i = [];
    this.complete = null;
    this.ha = 0;
  }
  function E(a) {
    this.o = a.stime;
    this.text = a.text;
    this.mode = a.mode;
    this.size = a.size;
    this.color = a.color;
    this.wa = a.date;
    this.border = a.border || !1;
    this.borderColor = a.borderColor || 0;
    this.on = !1;
  }
  function f(a, b) {
    this.f = a;
    this.b = b;
    this.height = this.width = 0;
    this.canvas = null;
    this.bottom = this.y = this.x = this.speed = this.ea = this.end = this.start = 0;
    this.index = 16777215;
    this.Ha();
  }
  function h(a) {
    this.a = q(g);
    for (var b in a) {
      this.a[b] = a[b];
    }
    this.m = new A(this.a);
    this.paused = !0;
    this.I = 0;
    this.S = 4294967296;
    this.k = (new Date).getTime();
    this.l = 0;
    this.q = !0;
    var c = this;
    k.setInterval(function() {
      c.ma();
      c.na();
    }, 1E3);
  }
  function A(a) {
    this.b = a;
    this.i = new m;
    this.g = new m;
    this.V = new p(this.ka);
    this.la = {1:new r(a), 4:new n(a), 5:new v(a)};
    this.H = 0;
  }
  function x(a) {
    this.b = a;
  }
  function r(a) {
    this.b = a;
    this.p = new u(a);
  }
  function n(a) {
    this.b = a;
    this.p = new w(a);
  }
  function v(a) {
    n.call(this, a);
  }
  function w(a) {
    this.b = a;
    this.c = [];
  }
  function u(a) {
    w.call(this, a);
  }
  function B(a, b, c, d) {
    this.ta = a;
    this.Sa = b || function(a) {
      return "ws://wschat.bilibili.com:8088/" + a;
    };
    this.fa = c;
    this.ga = d || k.PlayerSetOnline;
    this.WebSocket = k.WebSocket || k.MozWebSocket;
  }
  m.prototype = q(Array.prototype);
  m.prototype.constructor = m;
  m.prototype.remove = function(a) {
    for (var b = 0;b < this.length;b++) {
      if (this[b] == a) {
        this.splice(b, 1);
        break;
      }
    }
  };
  m.prototype.C = function(a, b) {
    if (0 == this.length || 0 > b(a, this[0])) {
      return 0;
    }
    if (0 <= b(a, this[this.length - 1])) {
      return this.length;
    }
    for (var c = 0, d = this.length - 1, e, f = 0;c <= d;) {
      e = Math.floor((c + d + 1) / 2);
      f++;
      if (0 <= b(a, this[e - 1]) && 0 > b(a, this[e])) {
        return e;
      }
      0 > b(a, this[e - 1]) ? d = e - 1 : 0 <= b(a, this[e]) ? c = e : console.error("Error!");
      if (1E3 < f) {
        console.error("1000!");
        break;
      }
    }
    return -1;
  };
  m.prototype.Y = function(a, b) {
    var c = this.C(a, b);
    this.splice(c, 0, a);
  };
  p.prototype = q(m.prototype);
  p.prototype.constructor = p;
  p.prototype.D = function() {
    for (var a = 0;a < arguments.length;) {
      this.Y(arguments[a], this.w), a++;
    }
    return this;
  };
  p.prototype.remove = function(a) {
    for (var b = this.C(a, this.w);0 <= b;) {
      if (this[b] === a) {
        return this.splice(b, 1), !0;
      }
      b--;
    }
    return !1;
  };
  p.prototype.Ba = function(a, b) {
    if (b <= a) {
      return [];
    }
    for (var c = a, d = [];c < b && c < this.length;) {
      d.push(this[c]), c++;
    }
    return d;
  };
  p.prototype.Ca = function(a, b) {
    var c = this.C(a, this.w), d = this.C(b, this.w);
    return this.Ba(c, d);
  };
  z.prototype = {constructor:z, parse:function(a) {
    if (a) {
      for (var b = a.getElementsByTagName("data"), c = 0;c < b.length;c++) {
        this.add(b[c]);
      }
      b = a.getElementsByTagName("d");
      for (c = 0;c < b.length;c++) {
        this.qa(b[c]);
      }
    }
    this.complete && this.complete();
  }, add:function(a) {
    var b = a.getElementsByTagName("playTime")[0].textContent;
    b || (b = a.getElementsByTagName("playTime")[0].text);
    var c = a.getElementsByTagName("message")[0], d = c.textContent;
    d || (d = c.text);
    var e = c.getAttribute("color"), f = c.getAttribute("mode"), c = c.getAttribute("fontsize"), l = a.getElementsByTagName("times")[0].textContent;
    l || (l = a.getElementsByTagName("times")[0].text);
    this.i.push({o:parseFloat(b), text:String(d).replace(/(\/n|\\n|\n|\r\n)/g, "\r"), mode:parseInt(f), size:parseInt(c), color:parseInt(e), wa:l});
  }, qa:function(a) {
    var b = a.getAttribute("p").split(","), c = a.textContent;
    c || (c = a.text);
    this.i.push({stime:parseFloat(b[0]), mode:parseInt(b[1]), size:parseInt(b[2]), color:parseInt(b[3]), date:parseInt(b[4]), "class":parseInt(b[5]), uid:b[6], dmid:parseInt(b[7]), text:String(c).replace(/(\/n|\\n|\n|\r\n)/g, "\r")});
  }, load:function(a, b) {
    var c = this, d = b ? b(a) : a;
    C(d, function(d, f) {
      d ? (console.log("reTry"), 10 > c.ha && (c.ha++, setTimeout(function() {
        c.load(a, b);
      }, 1E3))) : c.parse(f);
    });
  }};
  f.prototype = {constructor:f, Ha:function() {
    var a = this.b.F(this.f, this.b);
    this.canvas = a.Z;
    this.width = a.width;
    this.height = a.height;
    this.Fa();
    1 == this.f.mode && (this.Ea(), this.ea = this.start + this.b.width / this.speed, this.end = this.start + (this.b.width + this.width) / this.speed);
  }, Ea:function() {
    this.speed = (512 + this.width) / this.b.duration;
  }, Fa:function() {
    this.start = this.f.o;
    this.end = this.start + this.b.duration;
  }, d:function(a, b) {
    this.y = a;
    this.bottom = this.y + this.height;
    this.index = b;
  }, M:function(a) {
    return this.b.width - (a - this.start) * this.speed;
  }, Da:function(a) {
    return this.M(a) + this.width;
  }, ca:function() {
    this.b.v && this.b.v(this.canvas, this.b);
    this.f = this.b = this.canvas = null;
  }};
  f.W = function(a, b) {
    var c = y.createElement("canvas"), d = c.getContext("2d"), e = a.text.split("\r"), h = 0, l = 0;
    d.font = "bold " + a.size * b.n + "px " + b.font;
    for (var l = e.length * a.size * b.n * 1.2, g = 0;g < e.length;g++) {
      var k = d.measureText(e[g]).width;
      k > h && (h = k);
    }
    c.setAttribute("width", h);
    c.setAttribute("height", l + 2);
    d.globalAlpha = b.alpha;
    a.border && (d.strokeStyle = t(a.borderColor), d.strokeRect(0, 0, h, l));
    d.font = "bold " + a.size * b.n + "px " + b.font;
    d.fillStyle = t(a.color);
    d.shadowOffsetX = 0;
    d.shadowOffsetY = 0;
    d.shadowBlur = 4;
    d.shadowColor = t(f.X(a));
    for (g = 0;g < e.length;g++) {
      d.fillText(e[g], 0, (g + 1) * a.size * b.n);
    }
    return {Z:c, width:h, height:l};
  };
  f.va = function(a, b, c, d) {
    try {
      null != a.canvas ? d.h.drawImage(a.canvas, b, c) : console.log(a, "Text has not initialized.");
    } catch (e) {
      console.warn(e);
    }
  };
  f.sa = function(a) {
    a.h.clearRect(0, 0, a.width, a.height);
  };
  f.Ga = function(a, b) {
    var c = y.createElement("div");
    c.style.cssText = "        position: absolute;        display: inline-block;        white-space: pre;        left: " + (b.e.offsetWidth - 1) + "px;        top: 0px;        pointer-events: none;        font-weight: bold;        " + b.xa;
    c.appendChild(y.createTextNode(a.text.replace(/\r/g, "\r\n")));
    c.style.color = t(a.color);
    c.style.fontSize = a.size * b.n + "px";
    c.style.fontFamily = b.font;
    c.style.opacity = b.alpha;
    c.style.textShadow = "1px 1px 2px " + t(f.X(a));
    a.border && (c.style.border = "solid 1px " + t(a.borderColor));
    b.e.appendChild(c);
    return {Z:c, width:c.offsetWidth, height:c.offsetHeight};
  };
  f.za = function(a, b, c) {
    a.canvas.style.left = b + "px";
    a.canvas.style.top = c + "px";
  };
  f.ya = function(a, b, c, d) {
    a.Oa || (a.Oa = !0, a.canvas.style.left = b + "px", a.canvas.style.top = c + "px", 4 !== a.f.mode && 5 !== a.f.mode && 1 === a.f.mode && (b = function(b) {
      return b + "transform: translateX(-" + (d.width + a.width) + "px);" + b + "transition: " + b + "transform " + (a.end - a.start) + "s linear;";
    }, a.canvas.style.cssText += [b("-webkit-"), b("")].join("")));
  };
  f.Aa = function(a, b) {
    b.e.removeChild(a);
  };
  f.X = function(a) {
    return a.color ? 0 : 16777215;
  };
  var g = {R:500, ia:60, font:"\u9ed1\u4f53", duration:3.5, width:512, height:384, alpha:1, n:1, N:!1, u:null, B:null, F:null, v:null, j:null, s:null, r:null, h:null, e:null, xa:"", Ua:function(a) {
    this.h = a;
    this.u = f.va;
    this.F = f.W;
    this.B = f.sa;
    this.e = this.v = null;
  }, Ia:function(a) {
    this.e = a;
    this.u = f.za;
    this.u = f.ya;
    this.F = f.Ga;
    this.v = f.Aa;
    this.h = this.B = null;
  }, ra:function(a) {
    this.j = function() {
      return a.currentTime;
    };
    this.s = function() {
      return a.paused || a.ended;
    };
    this.r = function() {
      return [a.offsetWidth, a.offsetHeight];
    };
  }, Ta:function() {
    this.j = this.s = this.r = null;
  }, Qa:function(a) {
    (this.N = a) ? this.j = function() {
      return (new Date).getTime() / 1E3;
    } : this.j = null;
  }};
  k.requestAnimationFrame = function() {
    return k.requestAnimationFrame || k.webkitRequestAnimationFrame || k.mozRequestAnimationFrame || k.oRequestAnimationFrame || k.msRequestAnimationFrame || function(a) {
      k.setTimeout(a, 1E3 / g.ia);
    };
  }();
  h.prototype = {constructor:h, play:function() {
    this.paused = !1;
    this.l = this.I;
    this.k = (new Date).getTime();
    this.I = 0;
    var a = this;
    k.requestAnimationFrame(function() {
      a.U();
    });
  }, pause:function() {
    this.paused = !0;
    this.I = this.l + (new Date).getTime() - this.k;
  }, U:function() {
    var a = (new Date).getTime(), b = this.l + a - this.k;
    if (this.a.j) {
      var c = 1E3 * this.a.j();
      1E3 < Math.abs(c - b) && (this.l = b = c, this.k = a);
    } else {
      b > this.S && (this.l = b = 0, this.k = a);
    }
    null != this.m && this.q && (this.m.Ka(b / 1E3), this.a.B && this.a.B(this.a), this.m.Ma(b / 1E3));
    if (!this.paused) {
      var d = this;
      k.requestAnimationFrame(function() {
        d.U();
      });
    }
  }, ja:function(a) {
    if (0 == arguments.length) {
      return this.q;
    }
    this.q != a && ((this.q = a) || this.m.aa());
    return a;
  }, alpha:function(a) {
    if (0 == arguments.length) {
      return this.a.alpha;
    }
    a = Number(a);
    isNaN(a) || (.1 > a && (a = .1), 1 < a && (a = 1), this.a.alpha !== a && (this.a.alpha = a));
  }, resize:function(a, b) {
    a && b && (this.a.width = a, this.a.height = b);
    this.a.e && (this.a.e.style.width = this.a.width + "px", this.a.e.style.height = this.a.height + "px");
    this.a.h && (this.a.h.canvas.setAttribute("width", this.a.width), this.a.h.canvas.setAttribute("height", this.a.height));
  }, Ra:function(a) {
    this.S = a;
  }, ma:function() {
    if (this.a.r) {
      var a = this.a.r(), b = a[0], a = a[1];
      b && a && (b == this.a.width && a == this.a.height || this.resize(b, a));
    }
  }, na:function() {
    if (this.a.s) {
      var a = this.a.s();
      a && !this.paused ? this.pause() : !a && this.paused && this.play();
    }
  }, pa:function(a) {
    a.hasOwnProperty("stime") || (a.stime = this.a.N ? (new Date).getTime() / 1E3 : (this.l + (new Date).getTime() - this.k) / 1E3);
    this.m.add(a);
    return a;
  }, Ja:function(a, b) {
    var c = new z, d = this;
    c.complete = function() {
      for (var a = 0;a < c.i.length;a++) {
        0 != c.i[a].text.replace(/\r/g, "").length && d.m.add(c.i[a]);
      }
    };
    c.load(a, b);
  }, Pa:function(a, b, c, d) {
    D(a, b, c, d);
  }};
  A.prototype = {constructor:A, ka:function(a, b) {
    return a.o - b.o;
  }, add:function(a) {
    a = new E(a);
    this.b.N ? this.J(a) : (this.i.push(a), this.V.D(a), a.border && this.J(a));
  }, Ka:function(a) {
    a -= .001;
    if (3 < Math.abs(this.H - a)) {
      this.aa();
    } else {
      for (var b = this.V.Ca({o:this.H}, {o:a});b.length;) {
        this.J(b.shift());
      }
    }
    this.H = a;
  }, oa:function(a) {
    return a.border ? !0 : this.g.length >= this.b.R ? !1 : !0;
  }, J:function(a) {
    if (!a.on && this.oa(a)) {
      var b = this.la[a.mode];
      if (b) {
        var c = b.ua(a);
        b.P(c);
        a.on = !0;
        this.g.push(c);
      }
    }
  }, T:function(a) {
    a.f.on = !1;
    a.t.O(a);
    this.g.remove(a);
  }, aa:function() {
    for (;this.g.length;) {
      this.T(this.g[0]);
    }
  }, Ma:function(a) {
    for (var b = this.g.length, c = [], d = 0;d < b;d++) {
      var e = this.g[d];
      e.t.update(e, a) ? this.b.u(e, e.K, e.L, this.b) : c.push(e);
    }
    b = c.length;
    for (d = 0;d < b;d++) {
      e = c[d], this.T(e);
    }
  }};
  x.prototype = {constructor:x, ua:function(a) {
    return new f(a, this.b);
  }, P:null, O:null, update:null};
  r.prototype = q(x.prototype);
  r.prototype.constructor = r;
  r.prototype.P = function(a) {
    this.p.add(a);
    a.t = this;
  };
  r.prototype.O = function(a) {
    this.p.remove(a);
    a.t = null;
    a.ca();
  };
  r.prototype.update = function(a, b) {
    if (a.end < b) {
      return !1;
    }
    a.K = a.M(b);
    a.L = a.y;
    return !0;
  };
  n.prototype = q(x.prototype);
  n.prototype.constructor = n;
  n.prototype.P = function(a) {
    this.p.add(a);
    a.t = this;
  };
  n.prototype.O = function(a) {
    this.p.remove(a);
    a.t = null;
    a.ca();
  };
  n.prototype.update = function(a, b) {
    if (a.end < b) {
      return !1;
    }
    a.K = a.x;
    a.L = this.b.height - a.y - a.height;
    return !0;
  };
  v.prototype = q(n.prototype);
  v.prototype.constructor = v;
  v.prototype.update = function(a, b) {
    if (a.end < b) {
      return !1;
    }
    a.K = a.x;
    a.L = a.y;
    return !0;
  };
  w.prototype = {constructor:w, add:function(a) {
    a.x = (this.b.width - a.width) / 2;
    a.height >= this.b.height ? a.d(0, -1) : this.d(a, 0);
  }, remove:function(a) {
    -1 != a.index && void 0 != this.c[a.index] && this.c[a.index].remove(a);
  }, Q:function(a, b, c) {
    b = a + b.height;
    for (var d = 0;d < this.c[c].length;d++) {
      var e = this.c[c][d];
      if (!(e.y > b || e.bottom < a)) {
        return !1;
      }
    }
    return !0;
  }, d:function(a, b) {
    var c = 0;
    this.c.length <= b && this.c.push(new m);
    var d = this.c[b];
    if (0 == d.length) {
      a.d(0, b), d.push(a);
    } else {
      if (this.Q(0, a, b)) {
        a.d(0, b), this.D(d, a);
      } else {
        for (var e = 0;e < d.length;e++) {
          c = d[e].bottom + 1;
          if (c + a.height > this.b.height) {
            break;
          }
          if (this.Q(c, a, b)) {
            a.d(c, b);
            this.D(d, a);
            return;
          }
        }
        this.d(a, b + 1);
      }
    }
  }, D:function(a, b) {
    a.Y(b, function(a, b) {
      return a.bottom - b.bottom;
    });
  }};
  u.prototype = q(w.prototype);
  u.prototype.constructor = u;
  u.prototype.add = function(a) {
    a.x = this.b.width;
    a.height >= this.b.height ? a.d(0, -1) : this.d(a, 0);
  };
  u.prototype.Q = function(a, b, c) {
    for (var d = a + b.height, e = b.x + b.width, f = 0;f < this.c[c].length;f++) {
      var g = this.c[c][f];
      if (!(g.y > d || g.bottom < a)) {
        if (g.Da(b.start) < b.x || g.M(b.start) > e) {
          if (!(g.end <= b.ea)) {
            return !1;
          }
        } else {
          return !1;
        }
      }
    }
    return !0;
  };
  B.prototype = {constructor:B, A:null, Na:0, G:!1, da:-1, ba:function() {
    if (!this.WebSocket) {
      return !1;
    }
    var a = this;
    this.G = !1;
    this.A = new this.WebSocket(this.Sa(this.ta));
    this.A.onmessage = function(b) {
      a.La(b.data);
    };
    this.A.onclose = function() {
      a.G || (-1 == a.da || a.Na++ < a.da) && setTimeout(function() {
        a.ba();
      }, 1E3);
    };
  }, close:function() {
    this.G = !0;
    this.A.close();
  }, La:function(a) {
    var b = parseInt("0x" + a.substr(0, 4));
    a = a.substr(4, b);
    if (a.length != b) {
      console.log("Packet invalid");
    } else {
      switch(a = JSON.parse(a), a.pkt_id) {
        case 1:
          var c = JSON.parse(a.payload);
          setTimeout(function() {
            "function" == typeof this.ga && this.ga(c);
          }, 1);
          break;
        case 2:
          a = JSON.parse(a.payload), b = a[1], a = a[0].split(","), a = {stime:parseFloat(a[0]), mode:parseInt(a[1]), size:parseInt(a[2]), color:parseInt(a[3]), date:parseInt(a[4]), rnd:a[5], "class":parseInt(a[6]), hash:a[7], dmid:a[8], text:b}, "function" == typeof this.fa && this.fa(a);
      }
    }
  }};
  k.Stage = h;
  h.prototype.play = h.prototype.play;
  h.prototype.addCmt = h.prototype.pa;
  h.prototype.loadCmtFile = h.prototype.Ja;
  h.prototype.setRange = h.prototype.Ra;
  h.prototype.sendCmt = h.prototype.Pa;
  h.prototype.visible = h.prototype.ja;
  h.prototype.resize = h.prototype.resize;
  g.setLiveMode = g.Qa;
  g.initializeByDiv = g.Ia;
  g.attachVideoElement = g.ra;
  g.setFont = function(a) {
    this.font = a;
  };
  g.setWidth = function(a) {
    this.width = a;
  };
  g.setHeight = function(a) {
    this.height = a;
  };
  g.setGetSizeFunc = function(a) {
    this.r = a;
  };
  g.setGetTimeFunc = function(a) {
    this.j = a;
  };
  g.setGetStateFunc = function(a) {
    this.s = a;
  };
  g.initializeHandlers = function(a, b, c) {
    this.F = a;
    this.u = b;
    this.v = c;
  };
  g.setTextScale = function(a) {
    this.n = a;
  };
  g.setDuration = function(a) {
    this.duration = a;
  };
  g.setAlpha = function(a) {
    this.alpha = a;
  };
  g.setMax = function(a) {
    this.R = a;
  };
  h.prototype.config = function() {
    return this.a;
  };
  k.Text = f;
  f.CanvasTextRender = f.W;
  h.prototype.connect = function(a, b, c) {
    (new B(a, function(a) {
      return a;
    }, b, c)).ba();
  };
})(window, document);

(function(p, m, z, n) {
  function u(a) {
    "undefined" === typeof a && (a = 0);
    var b;
    a = Math.floor(a) >> 0;
    b = ("0" + a % 60).slice(-2);
    b = Math.floor(a / 60) + ":" + b;
    5 > b.length && (b = "0" + b);
    return b;
  }
  function r(a, b, c) {
    if (a.addEventListener) {
      a.addEventListener(b, c, !1);
    } else {
      if (b = "on" + b, a.attachEvent) {
        a.attachEvent(b, c);
      } else {
        var e = a[b];
        a[b] = function(a) {
          a = a ? a : p.event;
          c.call(null, a);
          e && e.call(null, a);
        };
      }
    }
  }
  function t(a) {
    if (!a) {
      throw "Slider:\u7f3a\u5c11\u521d\u59cb\u5316\u53c2\u6570";
    }
    this.b = a;
    this.min = a.min || 0;
    this.max = a.max || 100;
    this.value = -1;
    this.label = a.label || "";
    this.f = this.b.f;
    this.parent = this.b.parent;
    this.p = 0;
    this.G = void 0 === this.b.G ? !1 : this.b.G;
    this.i = m.createElement("div");
    this.i.className = "ui-slider-container";
    this.Q = m.createElement("div");
    this.Q.className = "ui-slider-label";
    this.W = m.createElement("div");
    this.W.className = "ui-slider-thumb";
    this.ma = m.createElement("div");
    this.ma.className = "ui-slider-tracker";
    this.l = m.createElement("div");
    this.l.className = "ui-slider-event-layer";
    this.f = this.f || this.l;
    this.i.appendChild(this.ma);
    this.i.appendChild(this.Q);
    this.i.appendChild(this.W);
    this.i.appendChild(this.l);
    var b = this;
    r(this.l, "mousedown", function(a) {
      if (!a.hasOwnProperty("offsetX")) {
        var e = curtop = 0;
        if (a.offsetParent) {
          var v = a;
          do {
            e += v.offsetLeft, curtop += v.offsetTop;
          } while (v = v.offsetParent);
        }
        a.offsetX = a.layerX - e;
        a.offsetY = a.layerY - curtop;
      }
      b.onmousedown();
      b.onmousemove(a.pageX, a.pageY);
    });
    r(this.l, "touchstart", function(a) {
      b.onmousedown();
      b.ontouchmove(a.touches[0].pageX, a.touches[0].pageY);
    });
    r(this.f, "mouseup", function() {
      if (b.e) {
        b.onmouseup();
      }
    });
    r(this.f, "mouseup", function() {
      if (b.e) {
        b.onmouseup();
      }
    });
    n(this.f).mouseleave(function(a) {
      b.e && (console.log("out", a), b.onmouseup());
    });
    r(this.f, "touchend", function() {
      if (b.e) {
        b.onmouseup();
      }
    });
    n(this.f).mousemove(function(a) {
      if (b.e) {
        b.onmousemove(a.pageX, a.pageY);
      }
    });
    r(this.l, "touchmove", function(a) {
      b.ontouchmove(a.touches[0].pageX, a.touches[0].pageY);
    });
    this.b.parent.appendChild(this.i);
    this.T(this.label);
    this.v(this.b.value);
  }
  function d(a, b) {
    this.options = {send_cmt_url:"//corpcmt.hdslb.net/post", get_cmt_url:null};
    "object" == typeof b && (this.options = n.extend({}, this.options, b));
    this.options.q && this.options.q.match(/[\d*]/g) && (this.options.t = this.options.q.match(/[\d*]/g).join(""));
    this.a = a;
    this.h = d.C;
    this.A = d.va;
    this.r = !0;
    this.aa = null;
    this.K = 3E3;
    this.U = this.d = null;
    this.volume = 1;
    this.duration = this.currentTime = 0;
    this.Da = b.live;
    this.xa(this.options);
    this.start_video = this.V;
    this.random = Math.floor(1E5 * Math.random());
    this.O = !1;
    this.hb();
  }
  t.prototype = {onmousedown:function() {
    this.e = !0;
  }, onmouseup:function() {
    this.e && (this.e = !1, this.b.n && (this.b.n(this.p), this.v(this.p)));
  }, onmousemove:function(a) {
    if (this.e) {
      a = a - n(this.i).offset().left;
      a = this.ja(a);
      var b = this.p;
      this.p = a;
      this.v(a, !1);
      this.B(!0);
      this.G && this.b.n && this.p != b && this.b.n(this.p);
    }
  }, ontouchmove:function(a) {
    this.e && (a = a - n(this.i).offset().left, this.p = a = this.ja(a), this.v(a, !1), this.B(!0));
  }, ja:function(a) {
    var b = this.l.offsetWidth;
    a = Math.max(0, a);
    a = Math.min(b, a);
    return this.min + (this.max - this.min) * a / b;
  }, sa:function() {
    return (this.value - this.min) / (this.max - this.min);
  }, v:function(a, b) {
    b = !1 === b ? !1 : !0;
    a = Math.min(this.max, Math.max(this.min, a));
    this.value != a && (this.value = a, this.pa(a), b && this.b.n && this.b.n(a));
  }, setMax:function(a) {
    this.max = a;
    this.B();
  }, pa:function() {
    this.B();
    this.b.Ca ? this.T(this.label + ": " + this.b.Ca(this.value)) : this.T(this.label + ": " + this.value);
  }, B:function(a) {
    if (!this.e || a) {
      this.W.style.width = 100 * this.sa() + "%";
    }
  }, T:function(a) {
    this.Q.innerHTML = a;
  }};
  (function() {
    var a = m.createElement("style");
    a.type = "text/css";
    a.innerHTML = '.ui-slider-container {position: absolute;width: 100%;height: 30px;text-align: center;}.ui-slider-thumb {position: absolute;top: 0px;bottom: 0px;left: 0px;}.ui-slider-thumb:after {content: "";position: absolute;display: block;top: 0px;right: -30px;width: 30px;height: 30px;border-radius: 28px;box-shadow: 0 0 2pt rgba(0, 0, 0, 0.5);background-color: #fff;}.ui-slider-tracker {position: absolute;top: 0px;bottom: 0px;left: 0px;right: -30px;background: #888;}.ui-slider-event-layer {position: absolute;top: 0px;left: 0px;bottom: 0px;right: -30px;}.ui-slider-label {position: absolute;display: block;top: 0px;bottom: 0px;left: 0px;right: 0px;line-height: 30px;font-size: 10px;color: #fff;}';
    m.head.appendChild(a);
  })();
  d.C = 0;
  d.F = 1;
  d.s = 2;
  d.va = 0;
  d.za = 1;
  d.M = 2;
  d.k = 3;
  d.da = 4;
  d.ca = 5;
  d.Ba = function() {
    return null != (m.webkitFullscreenElement || m.k || m.mozFullScreenElement || m.msFullscreenElement);
  };
  d.Aa = function(a) {
    (a.webkitRequestFullScreen || a.mb || a.mozRequestFullScreen || a.msRequestFullscreen || function() {
    }).apply(a);
  };
  d.ea = function() {
    m.exitFullscreen ? m.exitFullscreen() : m.webkitExitFullscreen ? m.webkitExitFullscreen() : m.mozCancelFullScreen ? m.mozCancelFullScreen() : m.msExitFullscreen && m.msExitFullscreen();
  };
  d.prototype = {constructor:d, xa:function(a) {
    function b(a) {
      c.Ka(a);
    }
    a = a || {};
    var c = this;
    this.a.find(".btn-widescreen").click(function() {
      // c.h != d.F ? c.eb() : c.X();
      c.h != d.s ? c.cb() : c.X();
    });
    this.a.find(".btn-fullscreen").click(function() {
      c.h != d.s ? c.cb() : c.X();
    });
    m.addEventListener("webkitfullscreenchange", b, !1);
    m.addEventListener("mozfullscreenchange", b, !1);
    m.addEventListener("MSFullscreenChange", b, !1);
    m.addEventListener("fullscreenchange", b, !1);
    this.a.find(".display").mousemove(function(a) {
      c.Ja(a);
    }).click(function(a) {
      c.Ia(a);
    });
    this.a.find(".control-bar").click(function() {
      c.A == d.k && c.c(!1, c.K);
    });
    this.a.find(".btn-play").click(function(a) {
      e.hasClass("hide") ? c.Na(a) : e.click();
    });
    this.a.find(".btn-pause").click(function(a) {
      c.Ma(a);
    });
    this.a.find(".btn-share").click(function(a) {
      c.Pa(a);
    });
    this.a.find(".btn-comment").click(function(a) {
      c.Ha(a);
    });
    this.a.find(".btn-repeat").click(function(a) {
      c.Oa(a);
    });
    this.a.find(".btn-mute").click(function(a) {
      c.La(a);
    });
    this.a.find(".btn-unmute").click(function(a) {
      c.Sa(a);
    });
    this.a.find(".send-btn").click(function(a) {
      c.ha(a);
    });
    this.a.find(".text-input").keypress(function(a) {
      if (13 == a.which) {
        return c.ha(a), !1;
      }
    });
    this.U = new t({parent:this.a.find(".control-slider")[0], f:this.a.find(".display")[0], n:function(a) {
      c.Qa(a);
    }});
    new t({parent:this.a.find(".control-volume-slider")[0], f:this.a.find(".control-volume-slider")[0], G:!0, n:function(a) {
      c.Za(a);
    }, value:100 * this.volume});
    var e = c.a.find(".load-layer");
    a.Y && a.q ? (a.P && e.find("img").attr("src", a.P), e.click(function() {
      c.V();
    })) : e.addClass("hide");
    /iPad/.test(p.navigator.userAgent) ? (c.a.find(".btn-mute, .control-volume-slider, .btn-fullscreen").addClass("hide"), c.a.find(".control-bar").addClass("ipad")) : c.a.find(".btn-mute, .control-volume-slider, .btn-fullscreen, .btn-repeat").addClass("hide");
  }, ya:function(a, b) {
    a = a || "";
    b = b || "video/mp4";
    var c = this, e = this.a.find("video")[0];
    n(e).append(n("<source />").attr("src", a).attr("type", b));
    this.video = e;
    e.addEventListener("play", function() {
      c.Xa(e);
    });
    e.addEventListener("pause", function() {
      c.Wa(e);
    });
    e.addEventListener("waiting", function() {
      c.Ya(e);
    });
    e.addEventListener("loadstart", function() {
      c.Va(e);
    });
    e.addEventListener("canplay", function() {
      c.Ta(e);
    });
    e.addEventListener("ended", function() {
      c.Ua(e);
    });
    setInterval(function() {
      c.Ra();
    }, 100);
    this.o(d.za);
  }, Xa:function() {
    this.o(d.k);
  }, Wa:function() {
    this.o(d.da);
  }, Ya:function() {
    this.o(d.M);
  }, Va:function() {
    this.o(d.M);
  }, Ta:function() {
    this.o(d.k);
  }, Ua:function() {
    this.o(d.ca);
  }, o:function(a) {
    var b = this.A;
    if (b != a) {
      this.a.find(".state-icon i").removeClass("active");
      switch(a) {
        case d.k:
          var c = this;
          this.a.find(".btn-play").addClass("hide");
          this.a.find(".btn-pause").removeClass("hide");
          this.a.find(".player-box").addClass("full");
          this.a.find(".state-icon i.play-icon").addClass("active");
          this.N ? (this.N = !1, this.c(!1)) : this.c(!1, this.K);
          this.d.play();
          break;
        case d.da:
          c = this;
          this.a.find(".btn-pause").addClass("hide");
          this.a.find(".btn-play").removeClass("hide");
          this.a.find(".state-icon i.pause-icon").addClass("active");
          this.a.find(".state-icon i.pause-icon.active").bind("click", function() {
            n(this).unbind("click");
            c.S();
          });
          this.d.pause();
          break;
        case d.M:
          "undefined" === typeof this.N && (this.N = !0);
          this.O = !0;
          this.a.find(".state-icon").removeClass("hide");
          this.a.find(".state-icon i.buff-icon").addClass("active");
          break;
        case d.ca:
          this.a.find(".state-icon i.pause-icon").addClass("active");
      }
      a != d.k && (this.a.find(".player-box").removeClass("full"), this.c(!0));
      this.A = a;
      this.u(this.A, b);
    }
  }, u:function(a, b) {
    this.options.u && this.options.u(a, b);
  }, V:function() {
    var a = this.options, b = this;
    this.a.find(".load-layer").addClass("hide");
    this.ya(a.Y, a.na);
    this.wa();
    this.S();
    this.a.find("video").show();
    this.c(!1);
    this.a.find(".state-icon i.play-icon").bind("click", function() {
      n(this).hasClass("active") && b.ia();
    });
  }, ia:function() {
    var a = this.a.find("video")[0];
    a && a.pause();
  }, S:function() {
    var a = this.a.find("video")[0];
    a && a.play();
  }, ka:function(a) {
    this.video && (a = Math.max(0, a), this.options.H || (a = Math.min(a, this.duration - .5)), this.video.pause(), this.video.currentTime = a, this.video.play());
  }, bb:function(a) {
    this.volume = a;
    this.video && (this.video.volume = a);
  }, Ra:function() {
    this.fb(this.video.currentTime, this.video.duration);
  }, Qa:function(a) {
    this.ka(a);
  }, Za:function(a) {
    this.bb(a / 100);
  }, fb:function(a, b) {
    if (b != this.duration) {
      this.m = 0 < this.options.H ? Math.min(this.options.H, b) : b;
      var c = this.duration;
      this.duration = b;
      this.U.setMax(this.m);
      Math.floor(c) != Math.floor(this.m) && this.a.find(".time-total-text").text(u(this.m));
    }
    this.L && a >= this.m ? (this.L = !1, this.ka(this.duration - .1)) : a < this.m && !this.L && 0 < this.options.H && (this.L = !0);
    a != this.currentTime && (c = this.currentTime, this.currentTime = a, this.U.v(a, !1), Math.floor(c) != Math.floor(a) && this.a.find(".time-current-text").text(u(a > this.m ? this.m : a)));
  }, eb:function() {
    switch(this.h) {
      case d.C:
        this.a.find(".player-box").addClass("wide");
        break;
      case d.s:
        this.a.find(".player-box").removeClass("full"), this.c(!0), d.ea();
    }
    try {
      p.player_fullwin(!0);
    } catch (a) {
    }
    this.a.find(".btn-widescreen").addClass("active");
    this.h = d.F;
    this.D();
  }, X:function() {
    switch(this.h) {
      case d.s:
        d.ea(), this.a.find(".player-box").removeClass("full"), this.c(!0);
      case d.F:
        this.a.find(".player-box").removeClass("wide");
    }
    try {
      p.player_fullwin(!1);
    } catch (a) {
    }
    this.a.find(".btn-widescreen").removeClass("active");
    this.h = d.C;
    this.D();
  }, cb:function() {
    switch(this.h) {
      case d.C:
        this.a.find(".player-box").addClass("wide");
      case d.F:
        this.a.find(".player-box").addClass("full"), d.Aa(this.a[0]);
    }
    try {
      p.player_fullwin(!0);
    } catch (a) {
    }
    this.a.find(".btn-widescreen").removeClass("active");
    this.h = d.s;
    this.D();
  }, Ka:function() {
    d.Ba() || this.X();
  }, Ja:function(a) {
    this.h == d.s && (a.pageY >= 2 * this.a.height() / 3 ? this.r || this.c(!0) : this.r && this.c(!1));
  }, Ia:function(a) {
    a.target == this.a.find(".display")[0] && (this.r ? this.c(!1) : (this.c(!0), this.A == d.k && this.c(!1, this.K)));
  }, Na:function() {
    this.S();
  }, ha:function() {
    var a = this.a.find(".text-input").val();
    a.length && (this.a.find(".text-input").val(""), this.la(a));
  }, Ma:function() {
    this.ia();
  }, Pa:function(a) {
    "function" == typeof p.on_share_btn_click && p.on_share_btn_click.call(this, a);
  }, Ha:function() {
    if (!this.d) {
      return !1;
    }
    this.d.visible() ? (this.d.visible(!1), this.a.find(".btn-comment").removeClass("active")) : (this.d.visible(!0), this.a.find(".btn-comment").addClass("active"));
  }, Oa:function() {
    this.video && (this.video.loop ? (this.video.loop = !1, this.a.find(".btn-repeat").removeClass("active")) : this.a.find(".btn-repeat").addClass("active"));
  }, La:function() {
    this.a.find(".btn-mute").addClass("hide");
    this.a.find(".btn-unmute").removeClass("hide");
    this.a.find(".control-volume-slider").addClass("mute");
    this.video && (this.video.muted = !0);
  }, Sa:function() {
    this.a.find(".btn-unmute").addClass("hide");
    this.a.find(".btn-mute").removeClass("hide");
    this.a.find(".control-volume-slider").removeClass("mute");
    this.video && (this.video.muted = !1);
  }, c:function(a, b) {
    var c = this;
    clearTimeout(this.aa);
    a != this.r && (a ? (this.a.find(".control-bar").removeClass("hide"), this.a.find(".state-icon").removeClass("hide"), this.r = !0) : (this.O ? (this.O = !1, this.a.find(".state-icon").addClass("hide")) : this.a.find(".state-icon").removeClass("hide"), this.aa = setTimeout(function() {
      c.a.find(".control-bar").addClass("hide");
      c.a.find(".state-icon").addClass("hide");
      c.r = !1;
    }, b || 0)));
  }, wa:function() {
    var a = this, b = .618 + .382 / (2 * p.devicePixelRatio), c = new Stage({R:this.options.ba || 500});
    this.d = c;
    c.config().setDuration(4.5);
    c.config().setTextScale(b);
    c.config().setAlpha(.75);
    c.config().initializeByDiv(this.a.find(".comment-layer")[0]);
    c.config().attachVideoElement(this.video);
    c.config().setGetStateFunc(void 0);
    b = a.options.q;
    a.options.get_cmt_url && (b = a.options.get_cmt_url + a.options.t + ".xml");
    this.Da ? (c.config().setLiveMode(!0), c.connect(b, function(b) {
      a.d.addCmt(b);
    }, null, function(a) {
      try {
        if (a = a.substr(4, a.length), a = JSON.parse(a), "DANMU_MSG" == a.jb) {
          a = a.info;
          var b = a[0], c = {mode:parseInt(b[1]), size:parseInt(b[2]), color:parseInt(b[3]), date:parseInt(b[4]), rnd:b[5], "class":parseInt(b[6]), hash:b[7], dmid:b[8], text:a[1]};
          "function" == typeof this.Ga && this.Ga(c);
        }
      } catch (d) {
        console.log("Packet invalid");
      }
    })) : c.loadCmtFile(b, function(b) {
      return a.options.get_cmt_url ? b : b.replace(/comment\.bilibili\.[^\/]+/, function() {
        return "comment.bilibili.com";
      });
    });
    this.D();
    c.play();
  }, D:function() {
    if (!this.d) {
      return !1;
    }
    this.d.resize(this.video.offsetWidth, this.video.offsetHeight);
  }, la:function(a, b, c) {
    var e;
    if ("string" == typeof a) {
      e = n.trim(a), a = 16777215;
    } else {
      if ("object" == typeof a) {
        e = n.trim(a.msg), a = a.color || 16777215;
      } else {
        return !1;
      }
    }
    if (!e || !this.d) {
      return "function" == typeof c && c(), !1;
    }
    var d = {mode:1, size:25, color:16777215, kb:new Date / 1E3, nb:this.random, text:e}, m = this.video.currentTime || 0;
    d.border = !0;
    d.borderColor = 6750207;
    var q = this.d.addCmt(d);
    e = {cid:this.options.t, msg:e, pool:0, color:a, rnd:this.random, fontsize:25, mode:1, playtime:m, date:Date.parse(new Date)};
    this.options.send_cmt_url ? n.ajax({url:this.options.send_cmt_url, ob:{withCredentials:!0}, type:"get", data:e, success:function() {
      "function" == typeof b && b(q);
    }, error:function() {
      "function" == typeof c && c(q);
    }}) : "function" == typeof b && b(q);
  }, oa:function(a) {
    try {
      var b = "" + m.cookie, c = b.indexOf(a + "=");
      if (-1 == c || "" == a) {
        return "";
      }
      var e = b.indexOf(";", c);
      -1 == e && (e = b.length);
      return unescape(b.substring(c + a.length + 1, e));
    } catch (d) {
      return 0;
    }
  }, hb:function() {
    this.gb = new (function() {
      function a(a) {
        this.config = n.extend({}, a);
        this.url = this.config.url;
        this.WebSocket = p.WebSocket || p.MozWebSocket;
      }
      a.prototype = {constructor:a, g:null, J:!1, ab:0, ga:-1, Fa:function(a, c) {
        var e = new Uint8Array(a), d = new Uint8Array(c), m = new Uint8Array(e.byteLength + d.byteLength);
        m.set(e, 0);
        m.set(d, e.byteLength);
        return m.buffer;
      }, ra:function() {
        return p.TextEncoder ? new p.TextEncoder : {encode:function(a) {
          for (var c = new ArrayBuffer(a.length), e = new Uint8Array(c), d = 0, m = a.length;d < m;d++) {
            e[d] = a.charCodeAt(d);
          }
          return c;
        }};
      }, connect:function() {
        if (!this.WebSocket) {
          return !1;
        }
        var a = this;
        this.J = !1;
        this.g = new this.WebSocket(this.url);
        this.g.binaryType = "arraybuffer";
        this.g.onopen = function() {
          var c = JSON.stringify({uid:a.config.uid, roomid:a.config.t}), e = new ArrayBuffer(16), d = new DataView(e, 0), c = a.ra().encode(c);
          d.setInt32(0, 16 + c.byteLength);
          d.setInt16(4, 16);
          d.setInt16(6, 1);
          d.setInt32(8, 7);
          d.setInt32(12, 1);
          a.g.send(a.Fa(e, c));
        };
        this.g.onmessage = function(c) {
          a.$a(c.data);
        };
        this.g.onclose = function() {
          a.J || (-1 == a.ga || a.ab++ < a.ga) && setTimeout(function() {
            a.connect();
          }, 1E3 * Math.floor(3 * Math.random() + 3));
        };
      }, fa:function() {
        var a = new ArrayBuffer(16), c = new DataView(a, 0);
        c.setInt32(0, 16);
        c.setInt16(4, 16);
        c.setInt16(6, 1);
        c.setInt32(8, 2);
        c.setInt32(12, 1);
        this.g.send(a);
      }, close:function() {
        this.J = !0;
        this.g && this.g.close();
      }, $a:function(a) {
        var c = this;
        a = new DataView(a, 0);
        a.getInt32(0);
        a.getInt16(4);
        a.getInt16(6);
        var e = a.getInt32(8);
        a.getInt32(12);
        switch(e) {
          case 8:
            c.fa(), c.lb = setInterval(function() {
              c.fa();
            }, 3E4);
        }
      }};
      return a;
    }())({url:"https:" == p.location.protocol ? "wss://broadcast.chat.bilibili.com:4095/sub" : "ws://broadcast.chat.bilibili.com:4090/sub", uid:parseInt(this.oa("DedeUserID")), t:parseInt(this.options.t)});
    this.gb.connect();
  }};
  p.BiliH5Player = function() {
    this.options = {ele:"#bofqi", aid:null, cid:null, page:1, danmaku_number:150, season_type:null, qn:32, send_cmt_url:"//corpcmt.hdslb.net/post", get_cmt_url:null, live:!1, on_state_change:null, get_from_local:!1, comment:null, image:null, video_url:null, retry_times:5, max_duration:null};
    !function(a) {
      function b(a, b) {
        var c = (65535 & a) + (65535 & b);
        return (a >> 16) + (b >> 16) + (c >> 16) << 16 | 65535 & c;
      }
      function c(a, b) {
        return a << b | a >>> 32 - b;
      }
      function e(a, e, f, d, m, n, p) {
        return b(c(b(b(a, e & f | ~e & d), b(m, p)), n), e);
      }
      function d(a, e, f, m, n, p, q) {
        return b(c(b(b(a, e & m | f & ~m), b(n, q)), p), e);
      }
      function m(a, e, f, d, n, p, q) {
        return b(c(b(b(a, e ^ f ^ d), b(n, q)), p), e);
      }
      function q(a, e, f, d, m, n, p) {
        return b(c(b(b(a, f ^ (e | ~d)), b(m, p)), n), e);
      }
      function n(a, c) {
        a[c >> 5] |= 128 << c % 32;
        a[14 + (c + 64 >>> 9 << 4)] = c;
        var f, p, r, t, x, h = 1732584193, g = -271733879, k = -1732584194, l = 271733878;
        for (f = 0;f < a.length;f += 16) {
          p = h, r = g, t = k, x = l, g = q(g = q(g = q(g = q(g = m(g = m(g = m(g = m(g = d(g = d(g = d(g = d(g = e(g = e(g = e(g = e(g, k = e(k, l = e(l, h = e(h, g, k, l, a[f], 7, -680876936), g, k, a[f + 1], 12, -389564586), h, g, a[f + 2], 17, 606105819), l, h, a[f + 3], 22, -1044525330), k = e(k, l = e(l, h = e(h, g, k, l, a[f + 4], 7, -176418897), g, k, a[f + 5], 12, 1200080426), h, g, a[f + 6], 17, -1473231341), l, h, a[f + 7], 22, -45705983), k = e(k, l = e(l, h = e(h, g, k, l, a[f + 8],
          7, 1770035416), g, k, a[f + 9], 12, -1958414417), h, g, a[f + 10], 17, -42063), l, h, a[f + 11], 22, -1990404162), k = e(k, l = e(l, h = e(h, g, k, l, a[f + 12], 7, 1804603682), g, k, a[f + 13], 12, -40341101), h, g, a[f + 14], 17, -1502002290), l, h, a[f + 15], 22, 1236535329), k = d(k, l = d(l, h = d(h, g, k, l, a[f + 1], 5, -165796510), g, k, a[f + 6], 9, -1069501632), h, g, a[f + 11], 14, 643717713), l, h, a[f], 20, -373897302), k = d(k, l = d(l, h = d(h, g, k, l, a[f + 5], 5, -701558691),
          g, k, a[f + 10], 9, 38016083), h, g, a[f + 15], 14, -660478335), l, h, a[f + 4], 20, -405537848), k = d(k, l = d(l, h = d(h, g, k, l, a[f + 9], 5, 568446438), g, k, a[f + 14], 9, -1019803690), h, g, a[f + 3], 14, -187363961), l, h, a[f + 8], 20, 1163531501), k = d(k, l = d(l, h = d(h, g, k, l, a[f + 13], 5, -1444681467), g, k, a[f + 2], 9, -51403784), h, g, a[f + 7], 14, 1735328473), l, h, a[f + 12], 20, -1926607734), k = m(k, l = m(l, h = m(h, g, k, l, a[f + 5], 4, -378558), g, k, a[f +
          8], 11, -2022574463), h, g, a[f + 11], 16, 1839030562), l, h, a[f + 14], 23, -35309556), k = m(k, l = m(l, h = m(h, g, k, l, a[f + 1], 4, -1530992060), g, k, a[f + 4], 11, 1272893353), h, g, a[f + 7], 16, -155497632), l, h, a[f + 10], 23, -1094730640), k = m(k, l = m(l, h = m(h, g, k, l, a[f + 13], 4, 681279174), g, k, a[f], 11, -358537222), h, g, a[f + 3], 16, -722521979), l, h, a[f + 6], 23, 76029189), k = m(k, l = m(l, h = m(h, g, k, l, a[f + 9], 4, -640364487), g, k, a[f + 12], 11,
          -421815835), h, g, a[f + 15], 16, 530742520), l, h, a[f + 2], 23, -995338651), k = q(k, l = q(l, h = q(h, g, k, l, a[f], 6, -198630844), g, k, a[f + 7], 10, 1126891415), h, g, a[f + 14], 15, -1416354905), l, h, a[f + 5], 21, -57434055), k = q(k, l = q(l, h = q(h, g, k, l, a[f + 12], 6, 1700485571), g, k, a[f + 3], 10, -1894986606), h, g, a[f + 10], 15, -1051523), l, h, a[f + 1], 21, -2054922799), k = q(k, l = q(l, h = q(h, g, k, l, a[f + 8], 6, 1873313359), g, k, a[f + 15], 10, -30611744),
          h, g, a[f + 6], 15, -1560198380), l, h, a[f + 13], 21, 1309151649), k = q(k, l = q(l, h = q(h, g, k, l, a[f + 4], 6, -145523070), g, k, a[f + 11], 10, -1120210379), h, g, a[f + 2], 15, 718787259), l, h, a[f + 9], 21, -343485551), h = b(h, p), g = b(g, r), k = b(k, t), l = b(l, x);
        }
        return [h, g, k, l];
      }
      function p(a) {
        var b, c = "", e = 32 * a.length;
        for (b = 0;b < e;b += 8) {
          c += String.fromCharCode(a[b >> 5] >>> b % 32 & 255);
        }
        return c;
      }
      function r(a) {
        var b, c = [];
        c[(a.length >> 2) - 1] = void 0;
        for (b = 0;b < c.length;b += 1) {
          c[b] = 0;
        }
        var e = 8 * a.length;
        for (b = 0;b < e;b += 8) {
          c[b >> 5] |= (255 & a.charCodeAt(b / 8)) << b % 32;
        }
        return c;
      }
      function t(a) {
        return p(n(r(a), 8 * a.length));
      }
      function u(a, b) {
        var c, e, d = r(a), m = [], q = [];
        m[15] = q[15] = void 0;
        16 < d.length && (d = n(d, 8 * a.length));
        for (c = 0;16 > c;c += 1) {
          m[c] = 909522486 ^ d[c], q[c] = 1549556828 ^ d[c];
        }
        return e = n(m.concat(r(b)), 512 + 8 * b.length), p(n(q.concat(e), 640));
      }
      function y(a) {
        var b, c, e = "";
        for (c = 0;c < a.length;c += 1) {
          b = a.charCodeAt(c), e += "0123456789abcdef".charAt(b >>> 4 & 15) + "0123456789abcdef".charAt(15 & b);
        }
        return e;
      }
      function w(a, b, c) {
        return b ? c ? u(unescape(encodeURIComponent(b)), unescape(encodeURIComponent(a))) : y(u(unescape(encodeURIComponent(b)), unescape(encodeURIComponent(a)))) : c ? t(unescape(encodeURIComponent(a))) : y(t(unescape(encodeURIComponent(a))));
      }
      "function" == typeof define && define.ib ? define(function() {
        return w;
      }) : "object" == typeof module && module.qa ? module.qa = w : a.Ea = w;
    }(this);
  };
  BiliH5Player.prototype = {constructor:BiliH5Player, create:function(a) {
    var b = this;
    "object" == typeof a && (this.options = n.extend({}, this.options, a));
    a = this.options;
    if (!a.ele) {
      return this.I = {}, !1;
    }
    var c = n('<div class="player-container"><div class="dummy"></div><div class="player-box"><video width=100% height="100%" preload="auto" webkit-playsinline playsinline></video><div class="display"><div class="input-bar"><input class="text-input" type="text" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u5f39\u5e55"></input><button class="send-btn">\u53d1\u9001</button></div><div class="control-bar hide"> <span class="control-btn btn-play"><i class="player-icon icon-play"></i></span><span class="control-btn btn-pause hide"><i class="player-icon icon-pause"></i></span><div class="time-container"><span class="control-text time-current-text">00:00</span> <span class="control-time-split"></span> <span class="control-text time-total-text">24:00</span></div><div class="right"><span class="control-btn btn-mute"><i class="player-icon icon-mute"></i></span><span class="control-btn btn-unmute hide"><i class="player-icon icon-unmute"></i></span><span class="control-volume-slider"></span><span class="control-btn btn-comment active"><i class="player-icon icon-comment"></i></span><span class="control-btn btn-repeat"><i class="player-icon icon-repeat"></i></span><span class="control-btn btn-widescreen"><i class="player-icon icon-widescreen"></i></span><span class="control-btn btn-fullscreen active"><i class="player-icon icon-fullscreen"></i></span></div><div class="control-slider"></div></div><div class="comment-layer"></div><div class="load-layer"><img/><i class="player-icon icon-preview"></i></div><div class="state-icon"> <i class="buff-icon"></i> <i class="pause-icon"></i> <i class="play-icon"></i></div></div></div></div>');
    n(a.ele).append(c);
    if (a.get_from_local) {
      this.j = !0, this.w();
    } else {
      if (a.season_type) {
        if (!a.cid) {
          return this.j = !0, !1;
        }
        n.ajax({url:"//bangumi.bilibili.com/player/web_api/v2/ext/playurl", data:{cid:a.cid, platform:"html5", qn:a.qn || 32, season_type:a.season_type, build:"0.2.0", otype:"json", type:"mp4"}, xhrFields:{withCredentials:!0}, dataType:"json", success:function(c) {
          if (c.durl && c.durl[0]) {
            c.src = c.durl[0].url || c.durl[0].backup_url[0];
            b.j = !0;
            b.options.comment = "//comment.bilibili.com/" + a.cid + ".xml";
            b.options.video_url = c.src;
            try {
              "http:" !== p.location.protocol && (b.options.comment = b.options.comment.replace("http://", "https://"), b.options.video_url = b.options.video_url.replace("http://", "https://"));
            } catch (d) {
            }
            c.auto_start && (b.options.Z = c.auto_start);
          } else {
            b.j = !0, b.options.comment = "//comment.bilibili.com/1.xml", b.options.image = "//static.hdslb.com/images/transparent.gif", b.options.video_url = "//static.hdslb.com/error.mp4";
          }
          b.w();
        }, error:function() {
          b.j = !0;
          b.options.comment = "//comment.bilibili.com/1.xml";
          b.options.image = "//static.hdslb.com/images/transparent.gif";
          b.options.video_url = "//static.hdslb.com/error.mp4";
          b.w();
        }});
      } else {
        c = a.aid ? "aid=" + a.aid + "&page=" + a.page : this.ta();
        if (!c) {
          return this.j = !0, !1;
        }
        n.ajax({url:"//api.bilibili.com/playurl?" + c, data:{platform:"html5", quality:"1", vtype:"mp4", type:"jsonp", token:this.ua()}, xhrFields:{withCredentials:!0}, dataType:"jsonp", success:function(a) {
          if (a.cid && a.cid.match(/[\d*]/g) && a.durl && a.durl[0]) {
            a.src = a.durl[0].url || a.durl[0].backup_url[0];
            b.j = !0;
            try {
              "http:" !== p.location.protocol && (a.cid = a.cid.replace("http://", "https://"), a.src = a.src.replace("http://", "https://"), a.img = a.img.replace("http://", "https://"));
            } catch (c) {
            }
            b.options.comment = a.cid;
            b.options.image = a.img;
            b.options.video_url = a.src;
            a.auto_start && (b.options.Z = a.auto_start);
          } else {
            b.j = !0, b.options.comment = "//comment.bilibili.com/1.xml", b.options.image = "//static.hdslb.com/images/transparent.gif", b.options.video_url = "//static.hdslb.com/error.mp4";
          }
          b.w();
        }});
      }
    }
  }, w:function() {
    var a = this.options, b = this;
    if (a.video_url) {
      var c = n(a.ele);
      this.I = this.options.live ? new d(c, {send_cmt_url:a.send_cmt_url, get_cmt_url:a.get_cmt_url, Y:a.video_url, na:null, live:!0, q:a.comment, ba:a.danmaku_number, P:a.image, u:a.on_state_change}) : new d(c, {send_cmt_url:a.send_cmt_url, get_cmt_url:a.get_cmt_url, Y:a.video_url, na:"video/mp4", q:a.comment, ba:a.danmaku_number, P:a.image, u:a.on_state_change, H:a.max_duration});
      this.options.Z && player.V();
    } else {
      if (!this.j && 0 < retry_times) {
        setTimeout(function() {
          --retry_times;
          b.w();
          return !1;
        }, 500);
      } else {
        return this.I = {}, !1;
      }
    }
  }, ua:function() {
    var a = this.cookie.get("purl_token") ? this.cookie.get("purl_token") : "";
    a || (a = "bilibili_" + Date.parse(new Date) / 1E3, this.cookie.set("purl_token", a));
    return this.Ea(a);
  }, cookie:{get:function(a) {
    var b = "" + m.cookie, c = b.indexOf(a + "=");
    if (-1 == c || "" == a) {
      return "";
    }
    var d = b.indexOf(";", c);
    -1 == d && (d = b.length);
    return unescape(b.substring(c + a.length + 1, d));
  }, set:function(a, b) {
    var c = new Date;
    c.setTime(c.getTime() + 72E5);
    m.cookie = a + "=" + escape(b) + ";expires=" + c.toGMTString() + "; path=/; domain=.bilibili.com";
  }}, ta:function() {
    return p.location.href.split("?")[1];
  }, sendComment:function(a, b, c) {
    if (this.I) {
      this.I.la(a, b, c);
    } else {
      return !1;
    }
  }};
})(window, document, jQuery, $);

// ;!function(){
// 	var template = $('<div class="player-container"><div class="dummy"></div><div class="player-box"><video width=100% height="100%" preload="auto" webkit-playsinline></video><div class="display"><div class="input-bar"><input class="text-input" type="text" placeholder=""></input><button class="send-btn"></button></div><div class="control-bar hide"> <span class="control-btn btn-play"><i class="player-icon icon-play"></i></span><span class="control-btn btn-pause hide"><i class="player-icon icon-pause"></i></span><div class="time-container"><span class="control-text time-current-text">00:00</span> <span class="control-time-split"></span> <span class="control-text time-total-text">24:00</span></div><div class="right"><span class="control-btn btn-mute"><i class="player-icon icon-mute"></i></span><span class="control-btn btn-unmute hide"><i class="player-icon icon-unmute"></i></span><span class="control-volume-slider"></span><span class="control-btn btn-comment active"><i class="player-icon icon-comment"></i></span><span class="control-btn btn-repeat"><i class="player-icon icon-repeat"></i></span><span class="control-btn btn-widescreen"><i class="player-icon icon-widescreen"></i></span><span class="control-btn btn-fullscreen active"><i class="player-icon icon-fullscreen"></i></span></div><div class="control-slider"></div></div><div class="comment-layer"></div><div class="load-layer"><img/><i class="player-icon icon-preview"></i></div><div class="state-icon"> <i class="buff-icon"></i> <i class="pause-icon"></i> <i class="play-icon"></i></div></div></div></div>');
// 	var player;
// 	$('#bofqi').append(template);
// 	if(!html5data.live) {
// 		player = H5Player(template[0], html5data.src, html5data.cid, html5data.img, html5data.on_state_change);
// 	} else {
// 		player = H5LivePlayer(template[0], html5data.src, html5data.cid, html5data.img, html5data.on_state_change);
// 	}
// 	if(html5data.auto_start) {
// 		player.start_video();
// 	}
// 	delete window['html5data'];
// }();